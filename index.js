"use strict";var h=Object.create;var l=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var S=(s,t,o,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of k(t))!T.call(s,r)&&r!==o&&l(s,r,{get:()=>t[r],enumerable:!(e=b(t,r))||e.enumerable});return s};var p=(s,t,o)=>(o=s!=null?h(y(s)):{},S(t||!s||!s.__esModule?l(o,"default",{value:s,enumerable:!0}):o,s));var c=p(require("node:fs/promises")),n=p(require("@actions/core")),f=require("glob"),d=require("tap-parser");async function w(){let s=n.getInput("path",{required:!1})??"**/*.tap",t=n.getInput("show-successful",{required:!1})==="true",o=await(0,f.glob)(s);n.debug(`Found ${o.length} files:`),n.debug(o.join(`
`));for(let e of o)try{let r=await c.readFile(e,"utf-8"),m=d.Parser.parse(r);$(m,t)}catch(r){n.summary.addDetails(`Failed to process file "${e}"`,r?.message??JSON.stringify(r))}n.summary.write()}w().catch(()=>process.exit(1));var R={dashboardBase:"https://svg.test-summary.com/dashboard.svg",pass:"https://svg.test-summary.com/icon/pass.svg?s=12",fail:"https://svg.test-summary.com/icon/fail.svg?s=12",skip:"https://svg.test-summary.com/icon/skip.svg?s=12",none:"https://svg.test-summary.com/icon/none.svg?s=12"};function $(s,t){let o=s.filter(a=>a[0]==="complete").map(a=>a[1]);if(o.length===0||o.length>1)return;let e=o[0];if(!e)return;let r=D(e);n.summary.addImage(...r);let m=s.filter(a=>a[0]==="assert").map(a=>a[1]).sort((a,i)=>Number(a.ok)-Number(i.ok)),u=t?m:m.filter(a=>!a.ok);if(u.length>0){let a=[[{data:"Status",header:!0},{data:"Test",header:!0}]];for(let i of u){let g=i.name??i.id?.toString()??"Unknown Test";a.push([{data:i.ok?"\u2705":"\u274C"},{data:g}])}n.summary.addTable(a)}console.log(s),console.log(e)}function D(s){let t=[];s.pass>0&&t.push(`${s.pass} passed`),s.fail>0&&t.push(`${s.fail} failed`),s.skip>0&&t.push(`${s.skip} skipped`),s.todo>0&&t.push(`${s.todo} todo`);let o=t.join(", "),e=new URL(R.dashboardBase);return e.searchParams.set("p",s.pass.toString()),e.searchParams.set("f",s.fail.toString()),e.searchParams.set("s",s.skip.toString()),e.searchParams.set("t",s.todo.toString()),[e.toString(),o]}
